<!DOCTYPE html>
<html lang="en">
  <head>
    <title>UDP Listner</title>
    <link rel="stylesheet" href="main.css" />
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
      integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z"
      crossorigin="anonymous"
    />
  </head>
  <body>
    <h1>UDP Listner</h1>
    <input
      id="startBtn"
      class="btn btn-primary"
      type="button"
      value="Start"
      onclick="startUDP()"
    />
    <input
      id="closeBtn"
      class="btn btn-danger"
      type="button"
      value="Close"
      onclick="closeUDP()"
    />
    <div id="msgBorad"></div>
    <div id="dataDiv"></div>
  </body>
  <script>
    var startBtn = document.getElementById("startBtn");
    var closeBtn = document.getElementById("closeBtn");
    var msgBorad = document.getElementById("msgBorad");
    var dataDiv = document.getElementById("dataDiv");
    var dataColor = "red";
    var socket;

    function dataColorToggel() {
      if (dataColor == "red") dataColor = "blue";
      else dataColor = "red";
      return dataColor;
    }
    function closeUDP() {
      socket.close();
    }
    function startUDP() {
      const dgram = require("dgram");
      var ip = require("ip");

      socket = dgram.createSocket("udp4", {
        exclusive: false,
      });

      socket.on("message", (msg, req) => {
        dataDiv.innerHTML += `<p class="${dataColorToggel()}">${msg}</p>`;
        dataDiv.scrollTop = dataDiv.scrollHeight;
      });

      socket.bind("8081", "localhost");
      socket.on("listening", () => {
        const address = socket.address();
        if (address.address == "0.0.0.0" || address.address == "127.0.0.1")
          address.address = ip.address();
        closeBtn.disabled = false;
        startBtn.disabled = true;
        msgBorad.innerHTML = `listening ${address.address}:${address.port}<br>`;
      });

      socket.on("close", () => {
        startBtn.disabled = false;
        closeBtn.disabled = true;
        msgBorad.innerHTML = `<p class="red">Socket Disconnected<p>`;
      });
    }
  </script>
</html>
